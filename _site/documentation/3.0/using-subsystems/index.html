<!DOCTYPE html>
<html lang="en-US">
<head>
	
	<meta charset="UTF-8">

	<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Using Subsystems in FW/1 | FW/1 - The Invisible Framework</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Using Subsystems in FW/1" />
<meta name="author" content="Sean Corfield" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Framework One - is a family of small, lightweight, convention-over-configuration frameworks, primarily for CFML. FW/1 itself provides MVC, DI/1 provides dependency injection (a.k.a. inversion of control), and AOP/1 provides aspect-oriented programming features on top of DI/1." />
<meta property="og:description" content="Framework One - is a family of small, lightweight, convention-over-configuration frameworks, primarily for CFML. FW/1 itself provides MVC, DI/1 provides dependency injection (a.k.a. inversion of control), and AOP/1 provides aspect-oriented programming features on top of DI/1." />
<link rel="canonical" href="http://localhost:4000/documentation/3.0/using-subsystems/" />
<meta property="og:url" content="http://localhost:4000/documentation/3.0/using-subsystems/" />
<meta property="og:site_name" content="FW/1 - The Invisible Framework" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-08-30T16:18:00-04:00" />
<script type="application/ld+json">
{"headline":"Using Subsystems in FW/1","dateModified":"2014-08-30T16:18:00-04:00","datePublished":"2014-08-30T16:18:00-04:00","url":"http://localhost:4000/documentation/3.0/using-subsystems/","author":{"@type":"Person","name":"Sean Corfield"},"description":"Framework One - is a family of small, lightweight, convention-over-configuration frameworks, primarily for CFML. FW/1 itself provides MVC, DI/1 provides dependency injection (a.k.a. inversion of control), and AOP/1 provides aspect-oriented programming features on top of DI/1.","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/documentation/3.0/using-subsystems/"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="theme-color" content="#157878" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<link rel="stylesheet" href="/assets/css/style.css?v=a3debbe0e02ab81ebdefec1b0e258acd9a63d866" />
	<link href="/atom.xml" rel="alternate" title="FW/1 - The Invisible Framework" type="application/atom+xml">
</head>
<body>
	<a id="skip-to-content" href="#content">Skip to the content.</a>

	<header class="page-header" role="banner">
		<h1 class="project-name">Using Subsystems in FW/1</h1>
		<h2 class="project-tagline">Framework One - is a family of small, lightweight, convention-over-configuration frameworks, primarily for CFML. FW/1 itself provides MVC, DI/1 provides dependency injection (a.k.a. inversion of control), and AOP/1 provides aspect-oriented programming features on top of DI/1.</h2>
		
		<a href="/" class="btn">Home</a>
		<a href="/blog" class="btn">Blog</a>
		<a href="/documentation" class="btn">Documentation</a>
		
			<a href="https://github.com/framework-one/fw1/" class="btn" target="_blank">View on GitHub</a>
		
		
			<a href="https://github.com/framework-one/fw1/archive/master.zip" class="btn">Download 4.2 (Current)</a>
			<a href="https://github.com/framework-one/fw1/archive/v4.3.0-beta.1.zip" class="btn">Download 4.3 (Beta)</a>
		
		
			<a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS" class="btn">RSS</a>
		
	</header>

	<main id="content" class="main-content" role="main">
		<aside class="documentation-nav">
	<section>
		<a href="/documentation/changelog">Changelog</a><br />
		<a href="/documentation/roadmap/">Roadmap</a><br />
	</section>
	<section>
		<h3>4.3 Documentation (beta)</h3>
		<a href="/documentation/4.3/">Getting Started Guide</a><br />
		<a href="/documentation/4.3/developing-applications/">Developing Applications Guide</a><br />
		<a href="/documentation/4.3/using-aop-one/">Using AOP/1</a><br />
		<a href="/documentation/4.3/using-di-one/">Using DI/1</a><br />
		<a href="/documentation/4.3/using-subsystems/">Using Subsystems</a><br />
		<a href="/documentation/4.3/reference-manual/">Reference Manual</a><br />
		<a href="/documentation/4.3/changelog/">Change Log</a><br />
	</section>
	<section>
		<h3>4.2 Documentation (Current Master)</h3>
		<a href="/documentation/4.2/">Getting Started Guide</a><br />
		<a href="/documentation/4.2/developing-applications/">Developing Applications Guide</a><br />
		<a href="/documentation/4.2/using-aop-one/">Using AOP/1</a><br />
		<a href="/documentation/4.2/using-di-one/">Using DI/1</a><br />
		<a href="/documentation/4.2/using-subsystems/">Using Subsystems</a><br />
		<a href="/documentation/4.2/reference-manual/">Reference Manual</a><br />
		<a href="/documentation/4.2/changelog/">Change Log</a><br />
	</section>
	<section>
		<h3>4.1 Documentation</h3>
		<a href="/documentation/4.1/">Getting Started Guide</a><br />
		<a href="/documentation/4.1/developing-applications/">Developing Applications Guide</a><br />
		<a href="/documentation/4.1/using-aop-one/">Using AOP/1</a><br />
		<a href="/documentation/4.1/using-di-one/">Using DI/1</a><br />
		<a href="/documentation/4.1/using-subsystems/">Using Subsystems</a><br />
		<a href="/documentation/4.1/reference-manual/">Reference Manual</a><br />
		<a href="/documentation/4.1/changelog/">Change Log</a><br />
	</section>
	<section>
		<h3>4.0 Documentation</h3>
		<a href="/documentation/4.0/">Getting Started Guide</a><br />
		<a href="/documentation/4.0/developing-applications/">Developing Applications Guide</a><br />
		<a href="/documentation/4.0/using-aop-one/">Using AOP/1</a><br />
		<a href="/documentation/4.0/using-di-one/">Using DI/1</a><br />
		<a href="/documentation/4.0/using-subsystems/">Using Subsystems</a><br />
		<a href="/documentation/4.0/reference-manual/">Reference Manual</a><br />
		<a href="/documentation/4.0/changelog/">Change Log</a><br />
	</section>
	<section>
		<h3>3.5 Documentation</h3>
		<a href="/documentation/3.5/">Getting Started Guide</a><br />
		<a href="/documentation/3.5/cfml-and-clojure/">CFML and Clojure</a><br />
		<a href="/documentation/3.5/developing-applications/">Developing Applications Guide</a><br />
		<a href="/documentation/3.5/using-aop-one/">Using AOP/1</a><br />
		<a href="/documentation/3.5/using-di-one/">Using DI/1</a><br />
		<a href="/documentation/3.5/using-subsystems/">Using Subsystems</a><br />
		<a href="/documentation/3.5/reference-manual/">Reference Manual</a><br />
	</section>
	<section>
		<h3>3.1 Documentation</h3>
		<a href="/documentation/3.1/">Getting Started Guide</a><br />
		<a href="/documentation/3.1/developing-applications/">Developing Applications Guide</a><br />
		<a href="/documentation/3.1/using-aop-one/">Using AOP/1</a><br />
		<a href="/documentation/3.1/using-di-one/">Using DI/1</a><br />
		<a href="/documentation/3.1/using-subsystems/">Using Subsystems</a><br />
		<a href="/documentation/3.1/reference-manual/">Reference Manual</a><br />
	</section>
	<section>
		<h3>3.0 Documentation</h3>
		<a href="/documentation/3.0/">Getting Started Guide</a><br />
		<a href="/documentation/3.0/developing-applications/">Developing Applications Guide</a><br />
		<a href="/documentation/3.0/using-di-one/">Using DI/1</a><br />
		<a href="/documentation/3.0/using-subsystems/">Using Subsystems</a><br />
		<a href="/documentation/3.0/reference-manual/">Reference Manual</a><br />
	</section>
</aside>

<article>
	<p>Subsystems give you a way of dropping one or more small FW/1 applications into an existing one. Subsystems can be used to create modules that have no dependencies on the parent application or you can use subsystems to group common functionality together.</p>

<h2 id="enabling-subsystems">Enabling Subsystems</h2>
<p>If you set either <code class="language-plaintext highlighter-rouge">defaultSubsystem</code>, <code class="language-plaintext highlighter-rouge">siteWideLayoutSubsystem</code>, <code class="language-plaintext highlighter-rouge">subsystemDelimiter</code>, or <code class="language-plaintext highlighter-rouge">subsystems</code> in the framework configuration, then subsystems will be automatically enabled.</p>

<p>Otherwise, if you omit all of those to pick up their default values (of <code class="language-plaintext highlighter-rouge">"home"</code>, <code class="language-plaintext highlighter-rouge">"common"</code>, <code class="language-plaintext highlighter-rouge">":"</code>, and <code class="language-plaintext highlighter-rouge">{ }</code> respectively), you will need to explicitly set <code class="language-plaintext highlighter-rouge">usingSubsystems</code> to <code class="language-plaintext highlighter-rouge">true</code> in the framework configuration.</p>

<p>Once you enable subsystems, you’ll need to follow a couple of additional conventions:</p>

<ol>
  <li>Your site’s default application must also be implemented as a subsystem. By default, the framework will look in the sub-directory <code class="language-plaintext highlighter-rouge">home</code>. Setting <code class="language-plaintext highlighter-rouge">defaultSubsystem</code> overrides this default, letting you specify another folder as the default application module.</li>
  <li>A sitewide layout can be specified at <code class="language-plaintext highlighter-rouge">common/layouts/default.cfm</code> (by default). If this file exists, it will be applied. Setting <code class="language-plaintext highlighter-rouge">siteWideLayoutSubsystem</code> overrides this default, letting you specify another folder to look in for <code class="language-plaintext highlighter-rouge">layouts/default.cfm</code>.</li>
</ol>

<h2 id="accessing-subsystems">Accessing Subsystems</h2>
<p>To access a subsystem in the browser, you’ll have to specify it in the action:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>index.cfm?action=subsystem:section.item
</code></pre></div></div>

<p>If you leave off the subsystem in the url, the section and item will reference the default subsystem (by default <code class="language-plaintext highlighter-rouge">home:section.item</code>).</p>

<p>When creating links in your views and layouts, it’s recommended that you use <code class="language-plaintext highlighter-rouge">buildUrl()</code>. You do not have to specify the current subsystem inside <code class="language-plaintext highlighter-rouge">buildUrl()</code>, it will automatically be prepended. This method is preferred. If you change the name of a subsystem, all of your links inside the subsystem will correctly reflect the change.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>buildUrl('section.item') - action=currentSubsystem:section.item
</code></pre></div></div>

<p>You can also link to other subsystems:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>buildUrl('otherSubsystem:section.item') - action=otherSubsystem:section.item
</code></pre></div></div>

<h2 id="configuring-subsystems">Configuring Subsystems</h2>
<p>There is an optional method that can be declared in <code class="language-plaintext highlighter-rouge">Application.cfc</code> for configuring subsystems:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function setupSubsystem(subsystem) {}
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">setupSubsystem()</code> is called once for each subsystem, when a subsystem is initialized. When an application is reloaded, the initialized subsystems are cleared and <code class="language-plaintext highlighter-rouge">setupSubsystem()</code> will be called on the next request to a subsystem.</p>

<h3 id="framework-configuration">Framework Configuration</h3>

<p>The following options relate to subsystems:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">usingSubsystems</code> - This will be <code class="language-plaintext highlighter-rouge">true</code> if you are using subsystems. You only need to set this explicitly if you don’t specify any of the other subsystem configuration options below.</li>
  <li><code class="language-plaintext highlighter-rouge">defaultSubsystem</code> - This is the default subsystem when none is specified in the URL or form post.</li>
  <li><code class="language-plaintext highlighter-rouge">subsystemDelimiter</code> - This specifies the delimiter between the subsystem name and the action in a URL or form post. It cannot be <code class="language-plaintext highlighter-rouge">"."</code> since section and item would no longer be parsed correctly. It must be a legal URL character.</li>
  <li><code class="language-plaintext highlighter-rouge">siteWideLayoutSubsystem</code> - This specifies the subsystem that is used for the (optional) site-wide default layout.</li>
</ul>

<h2 id="controllers">Controllers</h2>
<p>Subsystem controllers are located in <code class="language-plaintext highlighter-rouge">subsystem/controllers</code> (e.g., <code class="language-plaintext highlighter-rouge">admin/controllers/login.cfc</code>, <code class="language-plaintext highlighter-rouge">home/controllers/main.cfc</code>).</p>

<h2 id="model-services-and-domain-objects">Model (Services and Domain Objects)</h2>
<p>Subsystem services are located in <code class="language-plaintext highlighter-rouge">subsystem/model/services</code> and domain objects in <code class="language-plaintext highlighter-rouge">subsystem/model/beans</code> (e.g., <code class="language-plaintext highlighter-rouge">admin/model/services/security.cfc</code> and <code class="language-plaintext highlighter-rouge">home/model/beans/user.cfc</code>).</p>

<h2 id="views">Views</h2>
<p>Subsystem views are located in <code class="language-plaintext highlighter-rouge">subsystem/views</code> (e.g., <code class="language-plaintext highlighter-rouge">admin/views/login/default.cfm</code> and <code class="language-plaintext highlighter-rouge">home/views/main/error.cfm</code>).</p>

<h2 id="layouts">Layouts</h2>
<p>Subsystem layouts are looked up in the same order as before, but with the additional inclusion of a sitewide layout, if it exists. The default sitewide layout folder is <code class="language-plaintext highlighter-rouge">common</code>. Subsystem specific layouts are located in <code class="language-plaintext highlighter-rouge">subsystem/layouts</code> (e.g., <code class="language-plaintext highlighter-rouge">admin/layouts/login.cfm</code>).</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">subsystem/layouts/section/item.cfm</code></li>
  <li><code class="language-plaintext highlighter-rouge">subsystem/layouts/section.cfm</code></li>
  <li><code class="language-plaintext highlighter-rouge">subsystem/layouts/default.cfm</code></li>
  <li><code class="language-plaintext highlighter-rouge">common/layouts/default.cfm</code></li>
</ul>

<p>The location of the latter is determined by the <code class="language-plaintext highlighter-rouge">siteWideLayoutSubsystem</code> configuration variable.</p>

<h2 id="using-bean-factories">Using Bean Factories</h2>
<p>The introduction of subsystems introduces the ability to have subsystem specific bean factories. If you let FW/1 use DI/1 (or AOP/1) to manage your beans, it will also do so automatically for subsystems, creating a bean factory for each subsystem (inspecting the same folders you configured for your main application, i.e., <code class="language-plaintext highlighter-rouge">model</code> and <code class="language-plaintext highlighter-rouge">controllers</code> by default), and setting the main bean factory as the parent of each subsystem bean factory. This is the recommended approach (naturally!).</p>

<p>The following bean factory methods are available for subsystems:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">setSubsystemBeanFactory( subsystem, beanFactory )</code> - sets up a subsystem specific bean factory</li>
  <li><code class="language-plaintext highlighter-rouge">hasSubsystemBeanFactory( subsystem )</code> - returns <code class="language-plaintext highlighter-rouge">true</code> if a subsystem specific bean factory exists for the named subsystem</li>
  <li><code class="language-plaintext highlighter-rouge">getBeanFactory()</code> - returns the bean factory for the current subsystem. Alternately, it can be used to retrieve the bean factory for another subsystem by passing the name of the subsystem (e.g., <code class="language-plaintext highlighter-rouge">getBeanFactory( subsystem )</code> ).</li>
  <li><code class="language-plaintext highlighter-rouge">getDefaultBeanFactory()</code> - returns the default bean factory that was passed to <code class="language-plaintext highlighter-rouge">setBeanFactory()</code> (at the top-level)</li>
</ul>

<h3 id="auto-wiring">Auto Wiring</h3>

<p>If you did not declare a subsystem specific bean factory, the framework will attempt to auto wire beans from the default bean factory into subsystem specific controllers and model components.</p>

<p>If you have declared a subsystem specific bean factory, the framework will attempt to auto wire only the beans in the subsystem specific bean factory into your subsystem controllers and model components. If a subsystem specific bean factory does not contain those beans, beans from the default bean factory will only be autowired into your subsystem controllers and model components if the default bean factory has been set as the parent of the subsystem specific bean factory.</p>

<p>If you declare a dependency of <code class="language-plaintext highlighter-rouge">property beanFactory;</code>, the bean factory that is autowired will be the bean factory in which that managed bean exists.</p>

<h3 id="setting-bean-factories-with-setupsubsystem">Setting Bean Factories With setupSubsystem()</h3>

<p>With <code class="language-plaintext highlighter-rouge">setupSubsystem()</code>, it’s possible to use your own convention to load subsystem specific bean factories, instead of either relying on FW/1’s conventions or explicitly declaring each one in <code class="language-plaintext highlighter-rouge">setupApplication()</code> for the main application. The following example uses ColdSpring and makes the assumption that each subsystem has a bean factory config file in a common subsystem specific folder. If the config file is found, it then loads the subsystem bean factory.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function setupSubsystem( subsystem ) {
    var bfConfigFilePath = subsystem &amp; '/config/coldspring.xml.cfm';
    // conditionally load bean factory for this subsystem by convention:
    try {
        if ( fileExists(expandPath('./') &amp; bfConfigFilePath) ) {
            var bf = new coldspring.beans.DefaultXmlBeanFactory();
            bf.loadBeans( bfConfigFilePath );
            bf.setParent( getDefaultBeanFactory() );
            setSubsystemBeanFactory( subsystem, bf );
        }
    } catch ( any e ) {
        // ignore exceptions caused by bad paths etc
    }
}
</code></pre></div></div>

<h3 id="accessing-other-bean-factories-from-a-subsystem">Accessing Other Bean Factories From A Subsystem</h3>

<p>If you have a default bean factory, you can access it in your controllers and views from any subsystem with <code class="language-plaintext highlighter-rouge">getDefaultBeanFactory()</code>.</p>

<p>While it’s not considered a best practice, there may be a chance when you will need to access a bean factory from another subsystem. You can do this by calling <code class="language-plaintext highlighter-rouge">getBeanFactory(subsystem)</code> (e.g., <code class="language-plaintext highlighter-rouge">getBeanFactory('user')</code>).</p>

</article>

		<footer class="site-footer">
			
				<span class="site-footer-owner"><a href="https://github.com/sneiland/sneiland.github.io">sneiland.github.io</a> is maintained by <a href="https://github.com/sneiland">sneiland</a>.</span>
			
		</footer>
	</main>
</body>
</html>